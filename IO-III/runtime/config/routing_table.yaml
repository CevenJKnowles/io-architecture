# =============================================================================
# IO-III Canonical Routing Table
# =============================================================================
# PURPOSE:
# - Deterministic, mode-driven routing
# - Enforces role separation (no overlap)
# - Supports a single-voice output with internal Challenger validation
#
# NOTE:
# - Master role is implemented in Python (io_iii/*) and is not a model.
# - This file is canonical and validated by invariants.
# =============================================================================

routing_table:
  # ---------------------------------------------------------------------------
  # Global rules (do not improvise)
  # ---------------------------------------------------------------------------
  rules:
    selection_method: mode

    # Hard boundaries: what each stage is allowed to do
    boundaries:
      data:
        allowed:
          - parse
          - extract
          - normalize
          - structure
        forbidden:
          - interpret
          - infer
          - rewrite_intent
          - style

      reasoning:
        allowed:
          - interpret
          - infer
          - reason
          - decide
        forbidden:
          - style
          - format_for_delivery

      challenger:
        allowed:
          - critique
          - detect_errors
          - propose_corrections
        forbidden:
          - final_output_voice
          - style

      draft:
        allowed:
          - format_for_delivery
          - clarity
          - tone
          - structure_output
        forbidden:
          - new_reasoning
          - introduce_new_facts

      fast:
        allowed:
          - lightweight_transform
          - quick_checks
        forbidden:
          - deep_reasoning
          - reinterpret_intent

  # ---------------------------------------------------------------------------
  # Model assignments (replaceable components)
  # ---------------------------------------------------------------------------
  models:
    data:
      provider: ollama
      name: gemma:latest

    reasoning:
      provider: ollama
      name: deepseek-r1:latest

    challenger:
      provider: ollama
      name: deepseek-r1:latest

    draft:
      provider: ollama
      name: Qwen3:8b

    fast:
      provider: ollama
      name: mistral:latest

  # ---------------------------------------------------------------------------
  # Mode pipelines (deterministic call sequence)
  # ---------------------------------------------------------------------------
  modes:
    executor:
      pipeline:
        - data
        - reasoning
        - challenger
        - draft

    explorer:
      pipeline:
        - reasoning
        - challenger
        - draft

    challenger:
      pipeline:
        - reasoning
        - challenger

  # ---------------------------------------------------------------------------
  # Internal defaults
  # ---------------------------------------------------------------------------
  defaults:
    # Challenger is always internal-only
    challenger_visibility: internal_only

    # If a mode isn't specified (should be rare), fall back deterministically
    fallback_mode: executor